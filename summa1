import boto3
import csv

# Initialize Boto3 Lake Formation client
lf_client = boto3.client('lakeformation')

# Specify CSV file path
csv_file_path = 'datalake_permissions.csv'

# Write permissions to CSV file
with open(csv_file_path, 'w', newline='') as csv_file:
    csv_writer = csv.writer(csv_file)

    # Write header row
    csv_writer.writerow(['CatalogId', 'Principal', 'PrincipalType', 'Resource', 'ResourceType', 'Permission', 'GrantOption', 'Grantable'])

    # List data lake permissions
    response = lf_client.list_permissions(
        CatalogId='your-catalog-id',  # Replace with your AWS account ID or leave as-is for the default account
        Principal={'DataLakePrincipalIdentifier': 'string'},
        ResourceType='CATALOG'|'DATABASE'|'TABLE'|'DATA_LOCATION'|'LF_TAG'|'LF_TAG_POLICY'|'LF_TAG_POLICY_DATABASE'|'LF_TAG_POLICY_TABLE',
        Resource={'Catalog': {}},  # Example resource, you can adjust as needed
        MaxResults=100  # Adjust as needed
    )

    # Write permission details to CSV
    for permission in response.get('PrincipalResourcePermissions', []):
        catalog_id = permission.get('CatalogId', '')
        principal = permission.get('Principal').get('DataLakePrincipalIdentifier', '')
        principal_type = permission.get('Principal').get('PrincipalType', '')
        resource = permission.get('Resource', '')
        resource_type = permission.get('ResourceType', '')
        permission_type = permission.get('Permissions', '')
        grant_option = permission.get('GrantOption', '')
        grantable = permission.get('Grantable', '')

        # Write the data to CSV
        csv_writer.writerow([catalog_id, principal, principal_type, resource, resource_type, permission_type, grant_option, grantable])

print(f"Data lake permissions extracted and written to {csv_file_path}")
