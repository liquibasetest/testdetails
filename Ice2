SELECT
  qh.query_id,
  qh.warehouse_name,
  qh.start_time,
  qh.end_time,
  qh.total_elapsed_time,
  qh.credits_used
FROM
  TABLE(INFORMATION_SCHEMA.QUERY_HISTORY()) qh
JOIN
  TABLE(INFORMATION_SCHEMA.WAREHOUSE_METERING_HISTORY()) wh
ON
  qh.start_time >= wh.start_time
  AND qh.end_time <= wh.end_time
  AND qh.warehouse_name = wh.warehouse_name
WHERE
  qh.query_type = 'SELECT'
  AND qh.start_time >= TIMESTAMP_LTZ('start_date_time')
  AND qh.end_time <= TIMESTAMP_LTZ('end_date_time');
